// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums para garantir integridade
enum UserRole {
  ADMIN
  OPERADOR
  MOTORISTA
}

enum TipoPessoa {
  PF
  PJ
}

enum StatusVeiculo {
  REGULAR
  FURTO
  IRREGULAR
}

enum StatusMotorista {
  PENDENTE
  ATIVO
  BLOQUEADO
}

// Tabela Central de Utilizadores (Login)


// Tabela Central (Pai)
model User {
  id        String   @id @default(uuid())
  name      String   // O nome fica aqui
  email     String   @unique
  password  String
  role      UserRole // ADMIN, OPERATOR, DRIVER
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relações 1 para 1 (Opcionais, pois um User só terá UM desses preenchido)
  admin    Admin?
  operator Operator?
  driver   Driver?

  @@map("users")
}

// Extensões (Filhos)

model Admin {
  id           String @id @default(uuid())
  // Removemos name, email, password daqui.
  
  // Dados específicos de Admin
  company      String?
  region       String?
  cpfCnpj      String?
  
  userId       String @unique
  user         User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("admins")
}

model Operator {
  id           String     @id @default(uuid())
  // Removemos name, email, password, role daqui.
  
  // Dados específicos de Operador
  type         TipoPessoa?    // Ex: "CLT", "PJ" (assumindo string ou enum)
  company      String?
  region       String?
  cpf          String?
  cnpj         String?
  
  userId       String     @unique
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("operators")
}

model Driver {
  id              String          @id @default(uuid())
  // Removemos name daqui.
  
  // Dados específicos de Motorista
  cnh             String          @unique
  status          StatusMotorista @default(PENDENTE)
  photoUrl        String?
  company         String?
  toxicologyExam  DateTime?
  publicToken     String          @unique @default(uuid())
  
  userId          String          @unique
  user            User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  currentVehicleId String?        @unique
  vehicle          Vehicle?       @relation(fields: [currentVehicleId], references: [id])

  @@map("drivers")
}

model Vehicle {
  id              String        @id @default(uuid())
  plate           String        @unique // Placa
  model           String
  brand           String
  color           String
  status          StatusVeiculo @default(REGULAR)
  licensingDate   DateTime
  ownerName       String
  
  driver          Driver? 

  @@map("vehicles")
}